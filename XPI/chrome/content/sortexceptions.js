
var aux={sort:function(){}};var excSorter={enabled:false,sBundle:'',button:'',init:function(){var bs=Components.classes["@mozilla.org/intl/stringbundle;1"].getService(Components.interfaces.nsIStringBundleService);this.sBundle=bs.createBundle("chrome://sortexceptions/locale/sortexceptions.properties");var elems=document.getElementsByTagName("hbox");var father=elems[elems.length-1];elems=father.getElementsByTagName("spacer");var child=elems[0];this.button=document.createElement("button");this.button.setAttribute("label",this.sBundle.GetStringFromName("labelEnab"));this.button.setAttribute("oncommand","excSorter.toggle();");father.insertBefore(this.button,child);},flipDomains:function(aString){var str="";var arrayOfStrings=aString.split(".");for(var i=0;i<arrayOfStrings.length;i++){str=arrayOfStrings[i]+"."+str;}
return str;},toggle:function(){if(this.enabled){this.disable();this.enabled=false;this.button.label=this.sBundle.GetStringFromName("labelEnab");}
else{this.enable();this.enabled=true;this.button.label=this.sBundle.GetStringFromName("labelDisab");};},enable:function(){aux.sort=gTreeUtils.sort;gTreeUtils.sort=this.sort;gPermissionManager.onPermissionSort('rawHost');},disable:function(){gTreeUtils.sort=aux.sort;gPermissionManager.onPermissionSort('rawHost');},sort:function(aTree,aView,aDataSet,aColumn,aLastSortColumn,aLastSortAscending){if(aColumn!='rawHost'){return aux.sort(aTree,aView,aDataSet,aColumn,aLastSortColumn,aLastSortAscending);}
else{var ascending=(aColumn==aLastSortColumn)?!aLastSortAscending:true;aDataSet.sort(function(a,b){var aa=excSorter.flipDomains(a[aColumn].toLowerCase());var bb=excSorter.flipDomains(b[aColumn].toLowerCase());return aa.localeCompare(bb);});if(!ascending)
aDataSet.reverse();aTree.view.selection.select(-1);aTree.view.selection.select(0);aTree.treeBoxObject.invalidate();aTree.treeBoxObject.ensureRowIsVisible(0);return ascending;}}};